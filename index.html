<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagicCards | Viral Greeting Generator</title>
    <style>
        :root { --primary: #ff4b6e; --sidebar-bg: #f8f9fa; --text-dark: #333; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar & Search */
        #sidebar { width: 260px; background: var(--sidebar-bg); border-right: 1px solid #eee; padding: 20px; display: flex; flex-direction: column; }
        .search-box {
            width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd;
            margin-bottom: 20px; box-sizing: border-box; outline: none;
        }
        .search-box:focus { border-color: var(--primary); }

        #menu-container { flex: 1; overflow-y: auto; }
        .menu-item {
            padding: 12px 15px; margin: 5px 0; color: var(--text-dark);
            text-decoration: none; border-radius: 8px; cursor: pointer; font-weight: 500;
        }
        .menu-item:hover, .menu-item.active { background: #ffeef1; color: var(--primary); }

        /* Main Content */
        #main-content { flex: 1; overflow-y: auto; padding: 40px; background: #fff; }
        .hero { background: linear-gradient(135deg, #ff4b6e, #ff8e8e); color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .card-thumbnail { border: 1px solid #eee; border-radius: 15px; overflow: hidden; transition: 0.3s; cursor: pointer; background: #fff; position: relative; }
        .card-thumbnail:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .thumbnail-img { height: 140px; background: #fff0f3; display: flex; justify-content: center; align-items: center; font-size: 3rem; }
        .card-details { padding: 15px; }
        .card-details h3 { margin: 0; font-size: 1rem; color: #333; }

        .badge { position: absolute; top: 10px; right: 10px; background: var(--primary); color: white; padding: 3px 8px; border-radius: 5px; font-size: 0.6rem; font-weight: bold; }
    </style>
</head>
<body>

    <nav id="sidebar">
        <h2 style="color:var(--primary);">MagicCards ‚ù§Ô∏è</h2>
        <input type="text" class="search-box" id="searchInput" placeholder="Search cards..." onkeyup="handleSearch()">

        <div id="menu-container">
            <div class="menu-item active" onclick="filterCards('all', this)">üè† All Cards</div>
            </div>
    </nav>

    <main id="main-content">
        <div class="hero">
            <h1>Make Someone Smile Today! üöÄ</h1>
            <p>Select a prank or a greeting, add their name, and send the link.</p>
        </div>

        <div id="cardGrid" class="grid">
            </div>
    </main>

    <script>
        const sheetUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://docs.google.com/spreadsheets/d/e/2PACX-1vQ7Xp2IV6Zt4aMorOp9ivwlDIoO5bQFiFrIS4PCzEiBUeXmgK1WQj7egnZqB3skS7kUYJBE0040OAHh/pub?gid=0&single=true&output=csv');

        let allCardsData = [];

        async function init() {
            try {
                const response = await fetch(sheetUrl);
                const csvText = await response.text();
                const rows = csvText.split('\n').slice(1);

                allCardsData = rows.map(row => {
                    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return {
                        title: cols[0]?.replace(/"/g, '').trim(),
                        category: cols[1]?.replace(/"/g, '').trim(),
                        emoji: cols[2]?.replace(/"/g, '').trim(),
                        fileName: cols[3]?.replace(/"/g, '').trim()
                    };
                }).filter(c => c.title);

                buildDynamicMenu();
                renderCards(allCardsData);
            } catch (e) { console.error(e); }
        }

        function buildDynamicMenu() {
            const container = document.getElementById('menu-container');
            const cats = [...new Set(allCardsData.map(c => c.category))];
            cats.forEach(cat => {
                if(!cat) return;
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.innerText = cat.charAt(0).toUpperCase() + cat.slice(1);
                div.onclick = () => filterCards(cat, div);
                container.appendChild(div);
            });
        }

        function renderCards(cards) {
            const grid = document.getElementById('cardGrid');
            grid.innerHTML = cards.length ? '' : '<p>No cards found matching your search.</p>';
            cards.forEach(card => {
                const item = document.createElement('div');
                item.className = 'card-thumbnail';
                item.onclick = () => window.location.href = `create.html?file=${card.fileName}`;
                item.innerHTML = `
                    <div class="badge">NEW</div>
                    <div class="thumbnail-img">${card.emoji}</div>
                    <div class="card-details"><h3>${card.title}</h3></div>
                `;
                grid.appendChild(item);
            });
        }

        function handleSearch() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allCardsData.filter(c => c.title.toLowerCase().includes(term));
            renderCards(filtered);
        }

        function filterCards(cat, el) {
            document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            const filtered = cat === 'all' ? allCardsData : allCardsData.filter(c => c.category === cat);
            renderCards(filtered);
        }

        init();
    </script>
</body>
</html>